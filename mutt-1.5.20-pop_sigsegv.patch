diff -r b01d63af6fea pop.c
--- a/pop.c	Wed Jul 13 11:05:37 2011 -0500
+++ b/pop.c	Sun Oct 02 20:01:40 2011 +0200
@@ -618,8 +618,15 @@
   }
   rewind (msg->fp);
   uidl = h->data;
+  
+  /* we replace envelop, key in subj_hash has to be updated as well */
+  if (ctx->subj_hash && h->env->real_subj)
+    hash_delete (ctx->subj_hash, h->env->real_subj, h, NULL);
   mutt_free_envelope (&h->env);
   h->env = mutt_read_rfc822_header (msg->fp, h, 0, 0);
+  if (ctx->subj_hash && h->env->real_subj)
+    hash_insert (ctx->subj_hash, h->env->real_subj, h, 1);
+
   h->data = uidl;
   h->lines = 0;
   fgets (buf, sizeof (buf), msg->fp);
